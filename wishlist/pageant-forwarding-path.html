<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD>
<TITLE>PuTTY wish pageant-forwarding-path</TITLE>
<link rel="canonical" href="https://www.chiark.greenend.org.uk/~sgtatham/putty/wishlist/pageant-forwarding-path.html">
<link rel="stylesheet" type="text/css" href="../sitestyle.css" title="PuTTY Home Page Style">
<link rel="shortcut icon" href="putty.ico">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="robots" content="noindex,nofollow">
</HEAD>
<BODY>
<h1 align=center>PuTTY wish pageant-forwarding-path</h1>

<div align=center class="mirrorwarning">
This is a mirror. Follow this link to find
<a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/">the primary PuTTY web site</a>.
</div>

<p align=center>

<a href="../">Home</a>
 |

<a href="../faq.html">FAQ</a>
 |

<a href="../feedback.html">Feedback</a>
 |

<a href="../licence.html">Licence</a>
 |

<a href="../maillist.html">Updates</a>
 |

<a href="../mirrors.html">Mirrors</a>
 |

<a href="../keys.html">Keys</a>
 |

<a href="../links.html">Links</a>
 |

<a href="../team.html">Team</a>
<br>
Download:

<a href="../latest.html">Stable</a>
 &#183;

<a href="../snapshot.html">Snapshot</a>
 |

<a href="../docs.html">Docs</a>
 |

<a href="../changes.html">Changes</a>
 |

<a href="./">Wishlist</a>
</p>

<b>summary</b>: Track and use the agent-forwarding path in Pageant<br>
<b>class</b>: <i>wish:</i> This is a request for an enhancement.<br>
<b>difficulty</b>: <i>taxing:</i> Needs external things we don&#x27;t have (standards, users etc)<br>
<b>depends</b>: <a href="pageant-named-pipe.html">pageant-named-pipe</a><br>
<b>priority</b>: <i>low:</i> We aren&#x27;t sure whether to fix this or not.<br>
<p>
It would be handy if Pageant could treat clients differently depending
on whether they were local or agent-forwarded, and in the latter case,
where they were agent-forwarded from.

<p>
Uses for this might include:
<ul>
<li>Forwarding only a subset of the available keys: e.g. arrange to
forward a low-security key but not a more critical one to some
only-half-trusted server.
<li>Requiring manual confirmation of agent signing requests depending
on the source server.
<li>Blacklisting a particular host from any agent forwarding at all,
if for some reason you can't easily find all your SSH client
configurations to remove the agent forwarding option from
individually.
</ul>

<p>
In principle, you could set this up by a system along the lines of:
when any SSH client forwards a connection back to its agent, it begins
the connection by sending a message of its own announcing what server
it's forwarding from. If all SSH clients did this, then the
<em>real</em> agent would see a string of 'forwarded-from' notices at
the start of any client connection, and could trust each one not to
have been tampered with by the server named in it.

<p>
(E.g. suppose you make a series of SSH connections from your client to
host A, from A onwards to B, and from B to C. Then an agent connection
originating at C would arrive at your actual agent prefixed with three
forwarding notices listing hosts A,B,C, in that order. And if, say,
the agent had reason to mistrust host B, then it could still at least
trust the notice <em>mentioning</em> host B, because that notice was
generated by the more-trusted host A and there was nothing B could do
about it.)

<p>
In practice, it's not as easy as that. To begin with, this requires a
system of agent communication which is stateful (in the sense that
multiple requests from the same client can be linked to each other).
The Unix agent protocol already manages this, but on Windows, we'd
have to implement
<a href="pageant-named-pipe.html">pageant-named-pipe</a>
first.

<p>
Also, there's a question of protocol design. The agent protocol
proposed to the IETF working group did indeed include a
forwarding-notice message, but the OpenSSH-derived one used in
practice does not. So we'd have to start by inventing a protocol
extension, and making sure it was one that could be handled without
too much confusion by agents not supporting it. Also, SSH clients not
supporting the extension would fail to inject a forwarding notice, and
it's hard to think of any way that the ultimate agent could detect
that failure.

<p>
So it might not be feasible at all to track multi-hop forwardings
reliably. But you could still get something to work for the
<em>first</em> hop, I think, by inventing agent messages saying either
'I promise I am a local client' or 'I am a forwarding from server X',
and having the actual local clients send one or other of those
messages and also delete all such messages from the start of forwarded
connections.



<p><hr>
If you want to comment on this web site, see the
<a href="../feedback.html">Feedback page</a>.
<br>
<div class="audit"><a href="https://git.tartarus.org/?p=simon/putty-wishlist.git;a=history;f=data/pageant-forwarding-path;hb=refs/heads/main">Audit trail</a> for this wish.</div>

<div class="timestamp">(last revision of this bug record was at 2017-04-28 16:52:45 +0100)</div>

</BODY></HTML>
